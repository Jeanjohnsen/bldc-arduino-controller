# ⚡ Arduino BLDC Motor Controller (Radiolink RC + Uno)

Et **PlatformIO-projekt** der forbinder en *Radiolink AT10 transmitter + R12DS receiver* med en **Arduino UNO** og en ekstern **BLDC-controller**.  
Systemet styrer motorhastighed, retning, soft-start/stop og failsafe — optimeret til præcis og stabil drift.

---

## 🚀 Funktioner

✅ **Throttle via CH3 (joystick)**  
✅ **Retning via CH9 (2-position switch)**  
✅ **Blød acceleration/deceleration (soft ramp)**  
✅ **Failsafe ved signaltab (>200 ms)**  
✅ **Sikker retningsændring** (bremse → skift → accelerér)  
✅ **Punch-through ved fuld throttle (>95 %)**  
✅ **Seriel telemetri i realtid (115200 baud)**  

---

## ⚙️ Hardware-opsætning

### 🔌 Forbindelser

| Komponent | Pin | Forbundet til | Funktion |
|------------|-----|---------------|-----------|
| **Radiolink R12DS** | CH3 signal | Arduino **D2 (INT0)** | Throttle input |
| | CH9 signal | Arduino **D4** | Retningsinput (2-position switch) |
| | +5 V | Arduino **5V** | Receiver forsyning |
| | GND | Arduino **GND** | Fælles jord |
| **Arduino UNO** | D9 | BLDC **SV** | PWM-hastighedssignal (~490 Hz) |
| | D8 | BLDC **EN** | Enable (HIGH = aktiv) |
| | D7 | BLDC **FR** | Retning (HIGH=CW, LOW=CCW) |
| | GND | BLDC **GND** | Fælles jord |
| **BLDC-controller** | 24–48 V | Forsyning | Motorens strømforsyning |

> ⚠️ **Vigtigt:** Alle enheder skal dele fælles **GND**. Receiveren må kun forsynes med 5V!

---

## 🧱 Projektstruktur

```bash
bldc-arduino-controller/
├── platformio.ini
├── src/
│   └── main.cpp          # BLDC-controller kode (Arduino)
├── include/
├── lib/
└── README.md
```

---

## ⚙️ PlatformIO-konfiguration

`platformio.ini`:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
```

---

## 💻 Kompiler og upload

### VS Code (PlatformIO)
1. Åbn projektmappen i VS Code  
2. Klik **Build** (✔️) → **Upload** (→) → **Monitor** (🔍)

### Terminal
```bash
pio run                   # kompiler
pio run -t upload         # upload til Arduino
pio device monitor -b 115200  # seriel monitor
```

Afslut: `Ctrl + C`

---

## ⚙️ Funktionel beskrivelse

| Funktion | Beskrivelse |
|-----------|--------------|
| **Throttle (CH3)** | Læses som PWM via INT0 (mikrosekundmåling) og konverteres til duty-cycle 0–100 %. |
| **Retning (CH9)** | Digital 2-position switch (HIGH/LOW) styrer CW/CCW med støjfiltrering og debounce. |
| **Soft-start/stop** | Lineær ramp (600 ms default) for jævn acceleration/deceleration. |
| **Failsafe** | Hvis intet RC-signal i >200 ms → motor slukkes sikkert. |
| **Safe direction change** | Skifter kun retning, når motoren kører <10 %. |
| **Punch-through** | Sikrer 100 % duty ved >95 % throttle for maksimal effekt. |

---

## 📡 Seriel telemetri

Output i Serial Monitor (115200 baud):

```
THR(us)=1456  tgt=42% cur=41% dir=CW
```

| Felt | Forklaring |
|------|-------------|
| `THR(us)` | PWM-pulslængde fra receiver (CH3) |
| `tgt` | Mål-PWM i procent |
| `cur` | Nuværende PWM-output |
| `dir` | Retning (CW = med uret, CCW = mod uret) |

---

## ⚙️ Tuningsparametre

| Parameter | Default | Betydning |
|------------|----------|-----------|
| `RAMP_MS` | 600 | Tid for fuld ramp op/ned |
| `STEP_MS` | 10 | Opdateringsfrekvens for ramp |
| `FAILSAFE_MS` | 200 | Timeout før motorstop |
| `DIR_HYST_US` | 120 | Hysterese på retningssignal |
| `PUNCH_THRESH_PCT` | 95 | Punch-through tærskel |
| `RC_MID_US` | 1500 | Neutralpunkt for signal |

---

## 🧠 Tips og fejlfinding

- Hvis motoren kører “modsat”, byt HIGH/LOW i `setDirectionCW()`.  
- Hvis retningen flakker, tilføj ferritfilter eller kortere ledning til CH9.  
- Brug `INPUT_PULLUP` for at stabilisere retningskanalen (allerede aktiveret).  
- Alle jordforbindelser skal være **fælles** mellem Arduino, receiver og BLDC.  

---

## 🧩 Mulige udvidelser

- Rorstyring (servo) via CH1.  
- OLED-display til live-telemetri.  
- RPM-feedback via hall-sensor og PID-regulering.  
- Logging til SD-kort.

---

## 👤 Forfatter

**Jean Johnsen**  
📧 [jeanjohnsen@pm.me](mailto:jeanjohnsen@pm.me)  
🌐 [github.com/JeanJohnsen](https://github.com/JeanJohnsen)

---

## 🪪 Licens

Udgivet under **MIT-licensen**.  
Fri brug og modifikation tilladt – behold venligst denne licensfil.
