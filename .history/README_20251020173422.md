# âš¡ Arduino BLDC Motor Controller (Radiolink RC + Uno)

Et **PlatformIO-projekt** der forbinder en *Radiolink AT10 transmitter + R12DS receiver* med en **Arduino UNO** og en ekstern **BLDC-controller**.  
Systemet styrer motorhastighed, retning, soft-start/stop og failsafe â€” optimeret til prÃ¦cis og stabil drift.

---

## ğŸš€ Funktioner

âœ… **Throttle via CH3 (joystick)**  
âœ… **Retning via CH9 (2-position switch)**  
âœ… **BlÃ¸d acceleration/deceleration (soft ramp)**  
âœ… **Failsafe ved signaltab (>200 ms)**  
âœ… **Sikker retningsÃ¦ndring** (bremse â†’ skift â†’ accelerÃ©r)  
âœ… **Punch-through ved fuld throttle (>95 %)**  
âœ… **Seriel telemetri i realtid (115200 baud)**  

---

## âš™ï¸ Hardware-opsÃ¦tning

### ğŸ”Œ Forbindelser

| Komponent | Pin | Forbundet til | Funktion |
|------------|-----|---------------|-----------|
| **Radiolink R12DS** | CH3 signal | Arduino **D2 (INT0)** | Throttle input |
| | CH9 signal | Arduino **D4** | Retningsinput (2-position switch) |
| | +5 V | Arduino **5V** | Receiver forsyning |
| | GND | Arduino **GND** | FÃ¦lles jord |
| **Arduino UNO** | D9 | BLDC **SV** | PWM-hastighedssignal (~490 Hz) |
| | D8 | BLDC **EN** | Enable (HIGH = aktiv) |
| | D7 | BLDC **FR** | Retning (HIGH=CW, LOW=CCW) |
| | GND | BLDC **GND** | FÃ¦lles jord |
| **BLDC-controller** | 24â€“48 V | Forsyning | Motorens strÃ¸mforsyning |

> âš ï¸ **Vigtigt:** Alle enheder skal dele fÃ¦lles **GND**. Receiveren mÃ¥ kun forsynes med 5V!

---

## ğŸ§± Projektstruktur

```bash
bldc-arduino-controller/
â”œâ”€â”€ platformio.ini
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.cpp          # BLDC-controller kode (Arduino)
â”œâ”€â”€ include/
â”œâ”€â”€ lib/
â””â”€â”€ README.md
```

---

## âš™ï¸ PlatformIO-konfiguration

`platformio.ini`:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
```

---

## ğŸ’» Kompiler og upload

### VS Code (PlatformIO)
1. Ã…bn projektmappen i VS Code  
2. Klik **Build** (âœ”ï¸) â†’ **Upload** (â†’) â†’ **Monitor** (ğŸ”)

### Terminal
```bash
pio run                   # kompiler
pio run -t upload         # upload til Arduino
pio device monitor -b 115200  # seriel monitor
```

Afslut: `Ctrl + C`

---

## âš™ï¸ Funktionel beskrivelse

| Funktion | Beskrivelse |
|-----------|--------------|
| **Throttle (CH3)** | LÃ¦ses som PWM via INT0 (mikrosekundmÃ¥ling) og konverteres til duty-cycle 0â€“100 %. |
| **Retning (CH9)** | Digital 2-position switch (HIGH/LOW) styrer CW/CCW med stÃ¸jfiltrering og debounce. |
| **Soft-start/stop** | LineÃ¦r ramp (600 ms default) for jÃ¦vn acceleration/deceleration. |
| **Failsafe** | Hvis intet RC-signal i >200 ms â†’ motor slukkes sikkert. |
| **Safe direction change** | Skifter kun retning, nÃ¥r motoren kÃ¸rer <10 %. |
| **Punch-through** | Sikrer 100 % duty ved >95 % throttle for maksimal effekt. |

---

## ğŸ“¡ Seriel telemetri

Output i Serial Monitor (115200 baud):

```
THR(us)=1456  tgt=42% cur=41% dir=CW
```

| Felt | Forklaring |
|------|-------------|
| `THR(us)` | PWM-pulslÃ¦ngde fra receiver (CH3) |
| `tgt` | MÃ¥l-PWM i procent |
| `cur` | NuvÃ¦rende PWM-output |
| `dir` | Retning (CW = med uret, CCW = mod uret) |

---

## âš™ï¸ Tuningsparametre

| Parameter | Default | Betydning |
|------------|----------|-----------|
| `RAMP_MS` | 600 | Tid for fuld ramp op/ned |
| `STEP_MS` | 10 | Opdateringsfrekvens for ramp |
| `FAILSAFE_MS` | 200 | Timeout fÃ¸r motorstop |
| `DIR_HYST_US` | 120 | Hysterese pÃ¥ retningssignal |
| `PUNCH_THRESH_PCT` | 95 | Punch-through tÃ¦rskel |
| `RC_MID_US` | 1500 | Neutralpunkt for signal |

---

## ğŸ§  Tips og fejlfinding

- Hvis motoren kÃ¸rer â€œmodsatâ€, byt HIGH/LOW i `setDirectionCW()`.  
- Hvis retningen flakker, tilfÃ¸j ferritfilter eller kortere ledning til CH9.  
- Brug `INPUT_PULLUP` for at stabilisere retningskanalen (allerede aktiveret).  
- Alle jordforbindelser skal vÃ¦re **fÃ¦lles** mellem Arduino, receiver og BLDC.  

---

## ğŸ§© Mulige udvidelser

- Rorstyring (servo) via CH1.  
- OLED-display til live-telemetri.  
- RPM-feedback via hall-sensor og PID-regulering.  
- Logging til SD-kort.

---

## ğŸ‘¤ Forfatter

**Jean Johnsen**  
ğŸ“§ [jeanjohnsen@pm.me](mailto:jeanjohnsen@pm.me)  
ğŸŒ [github.com/JeanJohnsen](https://github.com/JeanJohnsen)

---

## ğŸªª Licens

Udgivet under **MIT-licensen**.  
Fri brug og modifikation tilladt â€“ behold venligst denne licensfil.
