# ⚡ BLDC Motor Controller (Arduino + Radiolink RC)

Et PlatformIO-projekt til at styre en **BLDC-motor** via **Arduino UNO**, en **Radiolink AT10 transmitter + R12DS receiver**, og en ekstern **BLDC-controller**.  
Projektet håndterer throttle, retning, soft-start/stop og failsafe — alt i ét elegant setup.

---

## 🚀 Funktioner

✅ **Throttle-styring via CH3 (joystick)**  
✅ **Retningsstyring via CH4** (CW/CCW)  
✅ **Blød acceleration og deceleration** (soft-start/stop)  
✅ **Failsafe ved signaltab**  
✅ **Automatisk RC-kalibrering** af throttle-endpoints  
✅ **Højere tophastighed** via optimeret PWM-frekvens (~490 Hz)  
✅ **Punch-through ved fuld throttle (100 %)**  
✅ **Seriel telemetri** i realtid: throttle-værdi, %-udgang, retning  

---

## ⚙️ Hardware-opsætning

### 🔌 Forbindelser

| Komponent | Pin | Forbundet til | Funktion |
|------------|-----|---------------|-----------|
| **Receiver R12DS** | CH3 signal | Arduino **D2** | Throttle-input |
| | CH4 signal | Arduino **D4** | Retningsinput |
| | +5 V | Arduino **5V** | Forsyning |
| | GND | Arduino **GND** | Fælles jord |
| **Arduino UNO** | D9 | BLDC **SV** | PWM-signal (hastighed) |
| | D8 | BLDC **EN** | Enable (HIGH = aktiv) |
| | D7 | BLDC **FR** | Retning |
| | GND | BLDC **GND** | Fælles jord |
| **Forsyning** | 24–48 V | BLDC-controller | Motor-forsyning |

> ⚠️ **Fælles GND** mellem **Arduino**, **receiver** og **BLDC-controller** er afgørende.  
> Receiveren skal kun forsynes med **5 V**, aldrig 24 V/48 V!

---

## 📁 Projektstruktur

```bash
bldc-arduino-controller/
├── platformio.ini
├── src/
│   └── main.cpp          # Optimeret BLDC-styringskode
├── include/
├── lib/
└── README.md
```

---

## 🔧 PlatformIO-konfiguration

`platformio.ini`:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
```

---

## 💻 Kompiler, upload og monitor

### Via VS Code (PlatformIO)

1. Åbn projektmappen i VS Code.  
2. Klik **Build** (✔️), **Upload** (→), og derefter **Monitor** (🔍).

### Via terminal
```bash
pio run           # kompiler
pio run -t upload # upload til Arduino
pio device monitor -b 115200 # åbn seriel monitor
```
Afslut monitor: `Ctrl + C`

---

## 🧠 Funktionel beskrivelse

- **Throttle (CH3)** → styrer duty-cycle 0–100 %  
- **Retning (CH4)** → CW/CCW; ved skift bremser motoren blødt ned, skifter FR, og accelererer igen  
- **Soft-start/stop:** lineær ramp-funktion for glidende bevægelse  
- **Failsafe:** motor stoppes blødt efter ~200 ms uden RC-signal  
- **Punch-through:** sikrer 100 % duty ved > 95 % throttle for maksimal tophastighed  
- **Auto-learn:** registrerer min/max RC-pulslængder (fx 1100–1900 µs) automatisk  

---

## 🧾 Seriel telemetri

Åbn Serial Monitor (115200 baud):

```
THR(us)=1578 span=[1090,1890] tgt=63% cur=61% dir=CW
```

| Felt | Betydning |
|-------|------------|
| `THR(us)` | Rå RC-pulslængde i mikrosekunder |
| `span` | Lærte min/max-værdier |
| `tgt` | Målrettet output-procent |
| `cur` | Nuværende PWM-procent (efter ramping) |
| `dir` | Retning (CW / CCW) |

---

## ⚡ Tips

- Hvis motoren ikke reagerer ved høj frekvens, skift til **D5 (976 Hz)** i koden (`USE_PWM_D5 = true`).  
- Justér `RAMP_MS` for hurtigere/langsommere acceleration.  
- Øg `DIR_HYST_US` hvis CH4 jitter får motoren til at flippe frem og tilbage.  
- Sørg for, at BLDC-controllerens **EN = HIGH** og **BK = LOW**.

---

## 🛠️ Fremtidige udvidelser

- 🕹️ Servo-styring via CH1 (ror)  
- 📊 OLED-display med live-telemetri  
- 🧩 PID-styring af motor-RPM  
- 🧱 Logning til SD-kort  

---

## 👤 Forfatter

**Jean Johnsen**  
📧 [jeanjohnsen@pm.me](mailto:jeanjohnsen@pm.me)  
🌐 [github.com/Jeanjohnsen](https://github.com/Jeanjohnsen)

---

## 🪪 Licens

Udgivet under **MIT-licensen**.  
Fri brug, deling og modifikation tilladt — behold venligst denne licensfil.
