# âš¡ BLDC Motor Controller (Arduino + Radiolink RC)

Et PlatformIO-projekt til at styre en **BLDC-motor** via **Arduino UNO**, en **Radiolink AT10 transmitter + R12DS receiver**, og en ekstern **BLDC-controller**.  
Projektet hÃ¥ndterer throttle, retning, soft-start/stop og failsafe â€” alt i Ã©t elegant setup.

---

## ğŸš€ Funktioner

âœ… **Throttle-styring via CH3 (joystick)**  
âœ… **Retningsstyring via CH4** (CW/CCW)  
âœ… **BlÃ¸d acceleration og deceleration** (soft-start/stop)  
âœ… **Failsafe ved signaltab**  
âœ… **Automatisk RC-kalibrering** af throttle-endpoints  
âœ… **HÃ¸jere tophastighed** via optimeret PWM-frekvens (~490 Hz)  
âœ… **Punch-through ved fuld throttle (100 %)**  
âœ… **Seriel telemetri** i realtid: throttle-vÃ¦rdi, %-udgang, retning  

---

## âš™ï¸ Hardware-opsÃ¦tning

### ğŸ”Œ Forbindelser

| Komponent | Pin | Forbundet til | Funktion |
|------------|-----|---------------|-----------|
| **Receiver R12DS** | CH3 signal | Arduino **D2** | Throttle-input |
| | CH4 signal | Arduino **D4** | Retningsinput |
| | +5 V | Arduino **5V** | Forsyning |
| | GND | Arduino **GND** | FÃ¦lles jord |
| **Arduino UNO** | D9 | BLDC **SV** | PWM-signal (hastighed) |
| | D8 | BLDC **EN** | Enable (HIGH = aktiv) |
| | D7 | BLDC **FR** | Retning |
| | GND | BLDC **GND** | FÃ¦lles jord |
| **Forsyning** | 24â€“48 V | BLDC-controller | Motor-forsyning |

> âš ï¸ **FÃ¦lles GND** mellem **Arduino**, **receiver** og **BLDC-controller** er afgÃ¸rende.  
> Receiveren skal kun forsynes med **5 V**, aldrig 24 V/48 V!

---

## ğŸ“ Projektstruktur

```bash
bldc-arduino-controller/
â”œâ”€â”€ platformio.ini
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.cpp          # Optimeret BLDC-styringskode
â”œâ”€â”€ include/
â”œâ”€â”€ lib/
â””â”€â”€ README.md
```

---

## ğŸ”§ PlatformIO-konfiguration

`platformio.ini`:

```ini
[env:uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
```

---

## ğŸ’» Kompiler, upload og monitor

### Via VS Code (PlatformIO)

1. Ã…bn projektmappen i VS Code.  
2. Klik **Build** (âœ”ï¸), **Upload** (â†’), og derefter **Monitor** (ğŸ”).

### Via terminal
```bash
pio run           # kompiler
pio run -t upload # upload til Arduino
pio device monitor -b 115200 # Ã¥bn seriel monitor
```
Afslut monitor: `Ctrl + C`

---

## ğŸ§  Funktionel beskrivelse

- **Throttle (CH3)** â†’ styrer duty-cycle 0â€“100 %  
- **Retning (CH4)** â†’ CW/CCW; ved skift bremser motoren blÃ¸dt ned, skifter FR, og accelererer igen  
- **Soft-start/stop:** lineÃ¦r ramp-funktion for glidende bevÃ¦gelse  
- **Failsafe:** motor stoppes blÃ¸dt efter ~200 ms uden RC-signal  
- **Punch-through:** sikrer 100 % duty ved > 95 % throttle for maksimal tophastighed  
- **Auto-learn:** registrerer min/max RC-pulslÃ¦ngder (fx 1100â€“1900 Âµs) automatisk  

---

## ğŸ§¾ Seriel telemetri

Ã…bn Serial Monitor (115200 baud):

```
THR(us)=1578 span=[1090,1890] tgt=63% cur=61% dir=CW
```

| Felt | Betydning |
|-------|------------|
| `THR(us)` | RÃ¥ RC-pulslÃ¦ngde i mikrosekunder |
| `span` | LÃ¦rte min/max-vÃ¦rdier |
| `tgt` | MÃ¥lrettet output-procent |
| `cur` | NuvÃ¦rende PWM-procent (efter ramping) |
| `dir` | Retning (CW / CCW) |

---

## âš¡ Tips

- Hvis motoren ikke reagerer ved hÃ¸j frekvens, skift til **D5 (976 Hz)** i koden (`USE_PWM_D5 = true`).  
- JustÃ©r `RAMP_MS` for hurtigere/langsommere acceleration.  
- Ã˜g `DIR_HYST_US` hvis CH4 jitter fÃ¥r motoren til at flippe frem og tilbage.  
- SÃ¸rg for, at BLDC-controllerens **EN = HIGH** og **BK = LOW**.

---

## ğŸ› ï¸ Fremtidige udvidelser

- ğŸ•¹ï¸ Servo-styring via CH1 (ror)  
- ğŸ“Š OLED-display med live-telemetri  
- ğŸ§© PID-styring af motor-RPM  
- ğŸ§± Logning til SD-kort  

---

## ğŸ‘¤ Forfatter

**Jean Johnsen**  
ğŸ“§ [jeanjohnsen@pm.me](mailto:jeanjohnsen@pm.me)  
ğŸŒ [github.com/Jeanjohnsen](https://github.com/Jeanjohnsen)

---

## ğŸªª Licens

Udgivet under **MIT-licensen**.  
Fri brug, deling og modifikation tilladt â€” behold venligst denne licensfil.
